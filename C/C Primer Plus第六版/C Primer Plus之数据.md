# C Primer Plus之数据

> 本节文档主要讲解C语言中数据类型有关的知识。

## 1. 示例程序

```c
/**
 * 了解C语言的数据类型
 * @author inconspicuousy
 * @date 2020/11/6
*/
#include <stdio.h>

int main(void) {
    // weight 体重
    // value 相等重量的白金价值
    float weight, value;

    printf("你知道与你相等体重的白金的价值吗？\n");
    printf("让我们来核查一下。\n");
    printf("请输出你的体重：");

    // 获取用户的输入，将输入的值转换成浮点类型
    scanf("%f", &weight);
    // 将体重转化成盎司单位后， 1盎司约等于1700美金
    // 这里默认1700.0是double类型，从double类型转换成float会警告可能会丢失数据
    value = 1700.0 * weight * 14.5833;

    printf("相等体重的白金的的价值为$%.2f。\n", value);
    printf("你是如此的值钱，\n");
    printf("吃的更多保持你的价格吧。\n");

    return 0;
}
```

### 1.1 程序剖析

- 浮点型变量的声明

```c
float weight, value;
```

这里声明了两个浮点型数据类型的变量。

- 浮点型数据类型的格式化输出

```c
printf("相等体重的白金的的价值为$%.2f。\n", value);
```

这里通过 `%f` 占位符来表明该处将处理一个浮点型数据，`.2f`控制浮点数的精度，最后将浮点数保留两位小数输出。

> 注意：
>
> 当占位符明确表示该处将以浮点数处理，而传参是一个整数类型时，因为在C语言中，整数和浮点数的存储方式不一致，所以会导致得不到理想中结果。
>
> ```c
> #include <stdio.h>
> 
> int main(void) {
>     int a = 1;
>     printf("%.2f", a);
> }
> ```
>
> 此处输出的结果为：
>
> ```
> 0.00
> ```

- 读取键盘的输入

```c
scanf("%f", &weight);
```

scanf函数主要用于读取键盘的输入，该条语句的作用有两个：

1. `%f`表示将用户输入的值转化成浮点数。
2. `&weight`告诉scanf函数把输入的值直接赋值给weight变量，`&`符号的作用是帮助scanf函数找到weight的地址。

- 变量和常量

```c
value = 1700.0 * weight * 14.5833;
```

这里的1700.0、14.5833就是常量，value、weight就是变量。

> 1、变量，在程序运行期间可能会改变或被赋值的值。
>
> 2、常量，在程序使用之前已经预先设定好了，在整个程序的运行过程中没有变化的值。

## 2. 位、字节、字、字长的概念

位、字节、字都是描述计算机数据单元或存储单元的术语。

| 单位 | 描述                                                         |
| ---- | ------------------------------------------------------------ |
| 位   | 位（bit）是`计算机中存储的最小单位`，可以存储0或1，位也是计算机内存的基本构建块。 |
| 字节 | 字节（byte）是`常用的计算机存储单元`，1字节均为8位，即1byte=8bit。 |
| 字   | 字（word）是 `设计计算机时给定的自然存储单位`，一个字通常由一个或多个字节构成。 |
| 字长 | 计算机的每个字所包含的位数（bit）称为字长。根据计算机的不同，字长有固定的和可变的两种。<br/>1、固定字长：字长度不论什么情况都是固定不变的；<br/>2、可变字长：在一定范围内，其长度是可变的。<br/>计算机的字长是指他一次可处理的二进制数字的数目。平时我们所说的32位计算机、64位计算机就是指计算机的字长。计算机的字长越长，就表示一次可处理的数据越多，性能越好。 |

## 3. 数据类型

### 3.1 数据类型关键字

| 最初的关键字 | C90标准添加的关键字 | C99标准添加的关键字 |
| ------------ | ------------------- | ------------------- |
| int          | signed              | _Bool               |
| long         | void                | _Complex            |
| short        |                     | _Imaginary          |
| unsigned     |                     |                     |
| char         |                     |                     |
| float        |                     |                     |
| double       |                     |                     |

> 注意：
>
> 上述关键字不是说C语言只有这么多数据类型，他们大多数是可以联合使用的。

### 3.2 数据类型

C语言中数据类型大致分为以下几种：

| 整数     | 浮点数 | 字符 | 布尔  | 复数     | 虚数       |
| -------- | ------ | ---- | ----- | -------- | ---------- |
| int      | float  | char | _Bool | _Complex | _Imaginary |
| long     | double |      |       |          |            |
| short    |        |      |       |          |            |
| unsigned |        |      |       |          |            |
| signed   |        |      |       |          |            |

> 注意：
>
> 1、char也可以表示较小的整数（依赖于unicode码）。
>
> 2、用int关键字表示基本的整数类型，用long、short、unsigned、signed提供基本整数类型的变式。
>
> 3、有些数据类型关键字可以联合使用，比如，long long int、unsign short int、long double等。

### 3.3 数据类型的存储方式。

通过数据类型关键字创建的类型，按照计算机的存储方式可分为两个基本类型。

- 整数类型

在C语言中，整数就是没有小数部分的数，计算机以二进制的数字存储整数。

- 浮点数类型

在C语言中有几种类型数字表示浮点数。

1. 有小数点的数就是浮点数（注意，即使小数点后面没有数字，那么这个值也是浮点数）。
2. e计数法，比如3.14E7表示3.16*10^7。

计算机把浮点数分成小数部分和指数部分来表示，而且分开存储这两部分。

在十进制下，可以把7.0转化成0.7E1，0.7是小数部分，1就是指数部分。

下面就是计算机中存储π的方式：

![](https://raw.githubusercontent.com/inconspicuousy-start/image/master/20201117223544.png)

> 注意：
>
> 1、因为浮点数和整数的存储方案不同，所以虽然7和7.00在数值上相同，但是他们的存储方式不同。
>
> 2、根据浮点数的存储方式来看，因为浮点数是依赖指数存储的，所以浮点数可以表示的范围比整数大。
>
> 3、浮点数只是实际值的近似值，比如7.0可能就被存储成浮点数6.99999。所以浮点数的计算一般都涉及到精度损失。

## 4. 数据类型的取值范围

在声明某个变量时，都会依据变量的数据类型在内存中分配指定的内存空间，该内存空间决定了该数据类型的取值范围。

下面是某些数据类型所占用的内存空间以及数据的取值范围。

| 数据类型                  | 内存空间                                                     | 取值范围                                                     |
| ------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| int                       | 一般情况下占用一个字长；但是当计算机的字长小于16位时，就需要占用更多个字长。 | 最小占用16位内存空间，所以最小的取值范围为 -32768~32767，随着计算机的字长越大，取值范围也就越大。 |
| short                     | short是short int的简写，占用的存储空间可能比int小            | 最小取值范围[−32767,32767]                                   |
| long、long int            | 占用的存储空间可能比int 多                                   | 对于32位机，long的最小取值范围 是[−2147483647,2147483647]    |
| long long int 、long long | 占用的存储空间可能比int 多                                   |                                                              |
| unsigned int、unsigned    | 只表示正整数，一般来说，因为int 的符号位被用来表示实际数值，所以无符号整型可以表示更大的数。 | 最小取值范 围是[0,65535]                                     |

> 注意：
>
> 1、变量在声明时就分配了指定的内存空间，即使没有被初始化赋值。
>
> 2、为什么其他整数类型的变量与int整数类型比较来看，都是可能大或者小于int的存储空间，是因为不同的字长的计算机存储某种数据类型可能会不一致。
>
> 3、一般来说，short占用16位，int占16位或者32位，long 占32 位，long long 占用64位。
>
> 4、如果需要定义一个32位的整数，应当考虑使用long来定义，因为这样不管是在16位计算机还是在32位计算机中都可以达到表示32位整数；而使用int的话，在16位计算机上int只能表示16位，就会出现数据丢失。
>
> 5、在需要定义16位的值时，如果不考虑特别注重内存，使用int即可；特别注重内存的话就要使用short。
>
> 6、程序代码中如果没有经过声明直接使用的整数，默认会使用int，超出int的范围会使用long int，依次是 unsigned long、long long、unsigned long long。特别的，如果想要不使用默认行为，比如强制使用long存储整数，那么在整数的后面加上L即可，其他的long long 就用LL，unsigned就用U表示。

## 5. 八进制和十六进制的表示方式

| 进制     | 特定前缀   | 占位符    | 带特定前缀占位符 |
| -------- | ---------- | --------- | ---------------- |
| 十进制   | 无         | %d        | %d               |
| 八进制   | 0（数字0） | %o        | %#o              |
| 十六进制 | 0x 或0X    | %x 或者%X | %#x 或者 %#X     |

- 代码

```c
#include <stdio.h>

int main() {
    int a = 21;
    int b = 021;
    int c = 0x21;
    printf("%d, %o, %x, %d\n", a, b, c, c);
    printf("%#o, %#x", b, c);
}
```

- 执行结果

```shell
21, 21, 21, 33
021, 0x21
```

我们从输出结果另外可以看出来，将十六进制以十进制输出时，会自动进行转换后输出。

## 6. 整数溢出

整数溢出表示整数超过了声明的数据类型的取值范围。一般情况下，整数最大值与最小值形成闭环，当超出最大值时，那么就会从最小值开始往上数。比如：

- 有符号整数的int，如果在32位机或者64位机上，最大的取值为2147483647，如果整数被赋值2147483648那么就会是最小值 -2147483647。
- 无符号整数的unsigned int，如果在32位机或者64位机上，最大的取值为4294967295，如果被赋值4294967296的话那么就会是最小值0。

代码演示

```c
#include <stdio.h>

int main() {
   int a = 2147483648;
   unsigned int b = 4294967296;

    printf("%d, %u", a, b);
}
```

执行结果

```
-2147483648, 0
```

